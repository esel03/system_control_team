meta:
  environment: python
  toolchain:
    name: pip
    version: "3.13"
build:
  requirementsPath: requirements.txt
  useCache: true
run:
  command: |
    #!/bin/bash
    set -e
    echo "Ожидание БД..."
    until python -c "import os; from sqlalchemy import create_engine; create_engine(os.getenv('DATABASE_URL')).connect().close()" 2>/dev/null; do
      echo "БД недоступна, ждём..."
      sleep 3
    done
    echo "БД готова"
    echo "Применяем миграции..."
    alembic upgrade head
    echo "Запуск приложения..."
    uvicorn main.main:app --host=0.0.0.0 --port=80
